{"version":3,"names":["React","useCallback","useMemo","useRef","useSharedValue","PortalProvider","BottomSheetModalProvider","BottomSheetModalInternalProvider","BottomSheetContainer","MODAL_STACK_BEHAVIOR","INITIAL_CONTAINER_HEIGHT","INITIAL_CONTAINER_OFFSET","BottomSheetModalProviderWrapper","children","animatedContainerHeight","animatedContainerOffset","sheetsQueueRef","handleMountSheet","key","ref","stackBehavior","_sheetsQueue","current","slice","sheetIndex","findIndex","item","sheetOnTop","length","currentMountedSheet","willUnmount","replace","minimize","splice","restore","push","handleUnmountSheet","hasMinimizedSheet","minimizedSheet","handleWillUnmountSheet","handleDismiss","sheetToBeDismissed","find","dismiss","handleDismissAll","map","externalContextVariables","dismissAll","internalContextVariables","containerHeight","containerOffset","mountSheet","unmountSheet","willUnmountSheet"],"sources":["BottomSheetModalProvider.tsx"],"sourcesContent":["import React, { useCallback, useMemo, useRef } from 'react';\nimport { useSharedValue } from 'react-native-reanimated';\nimport { PortalProvider } from '@gorhom/portal';\nimport {\n  BottomSheetModalProvider,\n  BottomSheetModalInternalProvider,\n} from '../../contexts';\nimport BottomSheetContainer from '../bottomSheetContainer';\nimport { MODAL_STACK_BEHAVIOR } from '../../constants';\nimport {\n  INITIAL_CONTAINER_HEIGHT,\n  INITIAL_CONTAINER_OFFSET,\n} from '../bottomSheet/constants';\nimport type { BottomSheetModalStackBehavior } from '../bottomSheetModal';\nimport type {\n  BottomSheetModalProviderProps,\n  BottomSheetModalRef,\n} from './types';\n\nconst BottomSheetModalProviderWrapper = ({\n  children,\n}: BottomSheetModalProviderProps) => {\n  //#region layout variables\n  const animatedContainerHeight = useSharedValue(INITIAL_CONTAINER_HEIGHT);\n  const animatedContainerOffset = useSharedValue(INITIAL_CONTAINER_OFFSET);\n  //#endregion\n\n  //#region variables\n  const sheetsQueueRef = useRef<BottomSheetModalRef[]>([]);\n  //#endregion\n\n  //#region private methods\n  const handleMountSheet = useCallback(\n    (key: string, ref: any, stackBehavior: BottomSheetModalStackBehavior) => {\n      const _sheetsQueue = sheetsQueueRef.current.slice();\n      const sheetIndex = _sheetsQueue.findIndex(item => item.key === key);\n      const sheetOnTop = sheetIndex === _sheetsQueue.length - 1;\n\n      /**\n       * Exit the method, if sheet is already presented\n       * and at the top.\n       */\n      if (sheetIndex !== -1 && sheetOnTop) {\n        return;\n      }\n\n      /**\n       * Minimize the current sheet if:\n       * - it exists.\n       * - it is not unmounting.\n       * - stack behavior is 'replace'.\n       */\n      const currentMountedSheet = _sheetsQueue[_sheetsQueue.length - 1];\n      if (\n        currentMountedSheet &&\n        !currentMountedSheet.willUnmount &&\n        stackBehavior === MODAL_STACK_BEHAVIOR.replace\n      ) {\n        currentMountedSheet.ref?.current?.minimize();\n      }\n\n      /**\n       * Restore and remove incoming sheet from the queue,\n       * if it was registered.\n       */\n      if (sheetIndex !== -1) {\n        _sheetsQueue.splice(sheetIndex, 1);\n        ref?.current?.restore();\n      }\n\n      _sheetsQueue.push({\n        key,\n        ref,\n        willUnmount: false,\n      });\n      sheetsQueueRef.current = _sheetsQueue;\n    },\n    []\n  );\n  const handleUnmountSheet = useCallback((key: string) => {\n    const _sheetsQueue = sheetsQueueRef.current.slice();\n    const sheetIndex = _sheetsQueue.findIndex(item => item.key === key);\n    const sheetOnTop = sheetIndex === _sheetsQueue.length - 1;\n\n    /**\n     * Here we remove the unmounted sheet and update\n     * the sheets queue.\n     */\n    _sheetsQueue.splice(sheetIndex, 1);\n    sheetsQueueRef.current = _sheetsQueue;\n\n    /**\n     * Here we try to restore previous sheet position if unmounted\n     * sheet was on top. This is needed when user dismiss\n     * the modal by panning down.\n     */\n    const hasMinimizedSheet = sheetsQueueRef.current.length > 0;\n    const minimizedSheet =\n      sheetsQueueRef.current[sheetsQueueRef.current.length - 1];\n    if (\n      sheetOnTop &&\n      hasMinimizedSheet &&\n      minimizedSheet &&\n      !minimizedSheet.willUnmount\n    ) {\n      sheetsQueueRef.current[\n        sheetsQueueRef.current.length - 1\n      ].ref?.current?.restore();\n    }\n  }, []);\n  const handleWillUnmountSheet = useCallback((key: string) => {\n    const _sheetsQueue = sheetsQueueRef.current.slice();\n    const sheetIndex = _sheetsQueue.findIndex(item => item.key === key);\n    const sheetOnTop = sheetIndex === _sheetsQueue.length - 1;\n\n    /**\n     * Here we mark the sheet that will unmount,\n     * so it won't be restored.\n     */\n    if (sheetIndex !== -1) {\n      _sheetsQueue[sheetIndex].willUnmount = true;\n    }\n\n    /**\n     * Here we try to restore previous sheet position,\n     * This is needed when user dismiss the modal by fire the dismiss action.\n     */\n    const hasMinimizedSheet = _sheetsQueue.length > 1;\n    if (sheetOnTop && hasMinimizedSheet) {\n      _sheetsQueue[_sheetsQueue.length - 2].ref?.current?.restore();\n    }\n\n    sheetsQueueRef.current = _sheetsQueue;\n  }, []);\n  //#endregion\n\n  //#region public methods\n  const handleDismiss = useCallback((key?: string) => {\n    const sheetToBeDismissed = key\n      ? sheetsQueueRef.current.find(item => item.key === key)\n      : sheetsQueueRef.current[sheetsQueueRef.current.length - 1];\n    if (sheetToBeDismissed) {\n      sheetToBeDismissed.ref?.current?.dismiss();\n      return true;\n    }\n    return false;\n  }, []);\n  const handleDismissAll = useCallback(() => {\n    sheetsQueueRef.current.map(item => {\n      item.ref?.current?.dismiss();\n    });\n  }, []);\n  //#endregion\n\n  //#region context variables\n  const externalContextVariables = useMemo(\n    () => ({\n      dismiss: handleDismiss,\n      dismissAll: handleDismissAll,\n    }),\n    [handleDismiss, handleDismissAll]\n  );\n  const internalContextVariables = useMemo(\n    () => ({\n      containerHeight: animatedContainerHeight,\n      containerOffset: animatedContainerOffset,\n      mountSheet: handleMountSheet,\n      unmountSheet: handleUnmountSheet,\n      willUnmountSheet: handleWillUnmountSheet,\n    }),\n    [\n      animatedContainerHeight,\n      animatedContainerOffset,\n      handleMountSheet,\n      handleUnmountSheet,\n      handleWillUnmountSheet,\n    ]\n  );\n  //#endregion\n\n  //#region renders\n  return (\n    <BottomSheetModalProvider value={externalContextVariables}>\n      <BottomSheetModalInternalProvider value={internalContextVariables}>\n        <BottomSheetContainer\n          containerOffset={animatedContainerOffset}\n          containerHeight={animatedContainerHeight}\n          children={null}\n        />\n        <PortalProvider>{children}</PortalProvider>\n      </BottomSheetModalInternalProvider>\n    </BottomSheetModalProvider>\n  );\n  //#endregion\n};\n\nexport default BottomSheetModalProviderWrapper;\n"],"mappings":"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"}