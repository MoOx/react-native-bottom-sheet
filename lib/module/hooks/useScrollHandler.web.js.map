{"version":3,"names":["useEffect","useRef","useSharedValue","useBottomSheetInternal","ANIMATION_STATE","SCROLLABLE_STATE","getRefNativeTag","useScrollHandler","scrollableRef","scrollableContentOffsetY","animatedScrollableState","animatedAnimationState","animatedScrollableContentOffsetY","element","scrollOffset","supportsPassive","maybePrevent","lastTouchY","initialContentOffsetY","shouldLockInitialPosition","handleOnTouchStart","event","touches","length","scrollTop","clientY","handleOnTouchMove","value","LOCKED","preventDefault","touchY","touchYDelta","handleOnTouchEnd","lockPosition","scroll","top","left","behavior","handleOnScroll","RUNNING","Math","max","stopPropagation","window","addEventListener","passive","e","removeEventListener","scrollHandler","undefined"],"sources":["useScrollHandler.web.ts"],"sourcesContent":["import { useEffect, useRef, TouchEvent } from 'react';\nimport { useSharedValue } from 'react-native-reanimated';\nimport { useBottomSheetInternal } from './useBottomSheetInternal';\nimport { ANIMATION_STATE, SCROLLABLE_STATE } from '../constants';\nimport { getRefNativeTag } from '../utilities/getRefNativeTag';\nimport type { Scrollable } from '../types';\n\nexport type ScrollEventContextType = {\n  initialContentOffsetY: number;\n  shouldLockInitialPosition: boolean;\n};\n\nexport const useScrollHandler = () => {\n  //#region refs\n  const scrollableRef = useRef<Scrollable>();\n  //#endregion\n\n  //#region variables\n  const scrollableContentOffsetY = useSharedValue<number>(0);\n  //#endregion\n\n  //#region hooks\n  const {\n    animatedScrollableState,\n    animatedAnimationState,\n    animatedScrollableContentOffsetY,\n  } = useBottomSheetInternal();\n  //#endregion\n\n  //#region effects\n  useEffect(() => {\n    const element = getRefNativeTag(scrollableRef) as any;\n\n    var scrollOffset = 0;\n    var supportsPassive = false;\n    var maybePrevent = false;\n    var lastTouchY = 0;\n\n    var initialContentOffsetY = 0;\n    var shouldLockInitialPosition = false;\n\n    function handleOnTouchStart(event: TouchEvent) {\n      if (event.touches.length !== 1) return;\n\n      initialContentOffsetY = element.scrollTop;\n      lastTouchY = event.touches[0].clientY;\n      maybePrevent = scrollOffset <= 0;\n    }\n\n    function handleOnTouchMove(event: TouchEvent) {\n      if (animatedScrollableState.value === SCROLLABLE_STATE.LOCKED) {\n        return event.preventDefault();\n      }\n\n      if (maybePrevent) {\n        maybePrevent = false;\n\n        const touchY = event.touches[0].clientY;\n        const touchYDelta = touchY - lastTouchY;\n\n        if (touchYDelta > 0) {\n          return event.preventDefault();\n        }\n      }\n\n      return true;\n    }\n\n    function handleOnTouchEnd() {\n      if (animatedScrollableState.value === SCROLLABLE_STATE.LOCKED) {\n        const lockPosition = shouldLockInitialPosition\n          ? initialContentOffsetY ?? 0\n          : 0;\n        element.scroll({\n          top: 0,\n          left: 0,\n          behavior: 'instant',\n        });\n        scrollableContentOffsetY.value = lockPosition;\n        return;\n      }\n    }\n\n    function handleOnScroll(event: TouchEvent) {\n      scrollOffset = element.scrollTop;\n\n      if (animatedAnimationState.value !== ANIMATION_STATE.RUNNING) {\n        scrollableContentOffsetY.value = Math.max(0, scrollOffset);\n        animatedScrollableContentOffsetY.value = Math.max(0, scrollOffset);\n      }\n\n      if (scrollOffset <= 0) {\n        event.preventDefault();\n        event.stopPropagation();\n        return false;\n      }\n      return true;\n    }\n\n    try {\n      // @ts-ignore\n      window.addEventListener('test', null, {\n        // @ts-ignore\n        get passive() {\n          supportsPassive = true;\n        },\n      });\n    } catch (e) {}\n\n    element.addEventListener(\n      'touchstart',\n      handleOnTouchStart,\n      supportsPassive\n        ? {\n            passive: true,\n          }\n        : false\n    );\n\n    element.addEventListener(\n      'touchmove',\n      handleOnTouchMove,\n      supportsPassive\n        ? {\n            passive: false,\n          }\n        : false\n    );\n\n    element.addEventListener(\n      'touchend',\n      handleOnTouchEnd,\n      supportsPassive\n        ? {\n            passive: false,\n          }\n        : false\n    );\n\n    element.addEventListener(\n      'scroll',\n      handleOnScroll,\n      supportsPassive\n        ? {\n            passive: false,\n          }\n        : false\n    );\n\n    return () => {\n      // @ts-ignore\n      window.removeEventListener('test', null);\n      element.removeEventListener('touchstart', handleOnTouchStart);\n      element.removeEventListener('touchmove', handleOnTouchMove);\n      element.removeEventListener('touchend', handleOnTouchEnd);\n      element.removeEventListener('scroll', handleOnScroll);\n    };\n  }, [\n    animatedAnimationState,\n    animatedScrollableContentOffsetY,\n    animatedScrollableState,\n    scrollableContentOffsetY,\n  ]);\n  //#endregion\n\n  return {\n    scrollHandler: undefined,\n    scrollableRef,\n    scrollableContentOffsetY,\n  };\n};\n"],"mappings":"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"}