{"version":3,"names":["useScrollHandler","scrollableRef","useRef","scrollableContentOffsetY","useSharedValue","animatedScrollableState","animatedAnimationState","animatedScrollableContentOffsetY","useBottomSheetInternal","useEffect","element","getRefNativeTag","scrollOffset","supportsPassive","maybePrevent","lastTouchY","initialContentOffsetY","shouldLockInitialPosition","handleOnTouchStart","event","touches","length","scrollTop","clientY","handleOnTouchMove","value","SCROLLABLE_STATE","LOCKED","preventDefault","touchY","touchYDelta","handleOnTouchEnd","lockPosition","scroll","top","left","behavior","handleOnScroll","ANIMATION_STATE","RUNNING","Math","max","stopPropagation","window","addEventListener","passive","e","removeEventListener","scrollHandler","undefined"],"sources":["useScrollHandler.web.ts"],"sourcesContent":["import { useEffect, useRef, TouchEvent } from 'react';\nimport { useSharedValue } from 'react-native-reanimated';\nimport { useBottomSheetInternal } from './useBottomSheetInternal';\nimport { ANIMATION_STATE, SCROLLABLE_STATE } from '../constants';\nimport { getRefNativeTag } from '../utilities/getRefNativeTag';\nimport type { Scrollable } from '../types';\n\nexport type ScrollEventContextType = {\n  initialContentOffsetY: number;\n  shouldLockInitialPosition: boolean;\n};\n\nexport const useScrollHandler = () => {\n  //#region refs\n  const scrollableRef = useRef<Scrollable>();\n  //#endregion\n\n  //#region variables\n  const scrollableContentOffsetY = useSharedValue<number>(0);\n  //#endregion\n\n  //#region hooks\n  const {\n    animatedScrollableState,\n    animatedAnimationState,\n    animatedScrollableContentOffsetY,\n  } = useBottomSheetInternal();\n  //#endregion\n\n  //#region effects\n  useEffect(() => {\n    const element = getRefNativeTag(scrollableRef) as any;\n\n    var scrollOffset = 0;\n    var supportsPassive = false;\n    var maybePrevent = false;\n    var lastTouchY = 0;\n\n    var initialContentOffsetY = 0;\n    var shouldLockInitialPosition = false;\n\n    function handleOnTouchStart(event: TouchEvent) {\n      if (event.touches.length !== 1) return;\n\n      initialContentOffsetY = element.scrollTop;\n      lastTouchY = event.touches[0].clientY;\n      maybePrevent = scrollOffset <= 0;\n    }\n\n    function handleOnTouchMove(event: TouchEvent) {\n      if (animatedScrollableState.value === SCROLLABLE_STATE.LOCKED) {\n        return event.preventDefault();\n      }\n\n      if (maybePrevent) {\n        maybePrevent = false;\n\n        const touchY = event.touches[0].clientY;\n        const touchYDelta = touchY - lastTouchY;\n\n        if (touchYDelta > 0) {\n          return event.preventDefault();\n        }\n      }\n\n      return true;\n    }\n\n    function handleOnTouchEnd() {\n      if (animatedScrollableState.value === SCROLLABLE_STATE.LOCKED) {\n        const lockPosition = shouldLockInitialPosition\n          ? initialContentOffsetY ?? 0\n          : 0;\n        element.scroll({\n          top: 0,\n          left: 0,\n          behavior: 'instant',\n        });\n        scrollableContentOffsetY.value = lockPosition;\n        return;\n      }\n    }\n\n    function handleOnScroll(event: TouchEvent) {\n      scrollOffset = element.scrollTop;\n\n      if (animatedAnimationState.value !== ANIMATION_STATE.RUNNING) {\n        scrollableContentOffsetY.value = Math.max(0, scrollOffset);\n        animatedScrollableContentOffsetY.value = Math.max(0, scrollOffset);\n      }\n\n      if (scrollOffset <= 0) {\n        event.preventDefault();\n        event.stopPropagation();\n        return false;\n      }\n      return true;\n    }\n\n    try {\n      // @ts-ignore\n      window.addEventListener('test', null, {\n        // @ts-ignore\n        get passive() {\n          supportsPassive = true;\n        },\n      });\n    } catch (e) {}\n\n    element.addEventListener(\n      'touchstart',\n      handleOnTouchStart,\n      supportsPassive\n        ? {\n            passive: true,\n          }\n        : false\n    );\n\n    element.addEventListener(\n      'touchmove',\n      handleOnTouchMove,\n      supportsPassive\n        ? {\n            passive: false,\n          }\n        : false\n    );\n\n    element.addEventListener(\n      'touchend',\n      handleOnTouchEnd,\n      supportsPassive\n        ? {\n            passive: false,\n          }\n        : false\n    );\n\n    element.addEventListener(\n      'scroll',\n      handleOnScroll,\n      supportsPassive\n        ? {\n            passive: false,\n          }\n        : false\n    );\n\n    return () => {\n      // @ts-ignore\n      window.removeEventListener('test', null);\n      element.removeEventListener('touchstart', handleOnTouchStart);\n      element.removeEventListener('touchmove', handleOnTouchMove);\n      element.removeEventListener('touchend', handleOnTouchEnd);\n      element.removeEventListener('scroll', handleOnScroll);\n    };\n  }, [\n    animatedAnimationState,\n    animatedScrollableContentOffsetY,\n    animatedScrollableState,\n    scrollableContentOffsetY,\n  ]);\n  //#endregion\n\n  return {\n    scrollHandler: undefined,\n    scrollableRef,\n    scrollableContentOffsetY,\n  };\n};\n"],"mappings":"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"}